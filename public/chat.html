<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Julie - Serial Chilleuse</title>
  <style>
    :root {
      --color-primary: #000000;
      --color-primary-hover: #413D44;
      --color-bg: #FFFFFF;
      --radius: 20px;
      --shadow: rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; background: var(--color-bg); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    body { display: flex; flex-direction: column; padding-top: 4rem; }

    /* Espacement spécifique sur l’écran d’intro */
#step-intro h2 {
  margin-bottom: 1.5rem;
}

#step-intro p {
  margin-bottom: 2rem;
}

#btn-intro-next {
  margin-top: 1rem;
}

    /* Style pour l’image de l’intro */
#step-intro .intro-image {
  display: block;           /* pour que margin auto fonctionne */
  margin: 0 auto 1.5rem;    /* centré + espace en dessous */
  width: 120px;             /* ajustez selon la dimension souhaitée */
  border-radius: var(--radius); /* optionnel : coins arrondis */
}

    /* ─── Chat bubbles ────────────────────────────────────────────────── */
.message-wrapper {
  display: flex;
  margin-bottom: 1rem;
}

.message-wrapper.bot {
  justify-content: flex-start;   /* bulles de Julie à gauche */
}

.message-wrapper.user {
  justify-content: flex-end;     /* bulles utilisateur à droite */
}

.message {
  max-width: 75%;
  padding: 0.75rem 1rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 4px var(--shadow);
  word-wrap: break-word;
}

/* Bulles de Julie */
.message.bot {
  background: #fff;
  color: #333;
}

/* Bulles de l’utilisateur */
.message.user {
  background: var(--color-primary);
  color: #fff;
}
    
   /* Micro-copy sous les autres options, juste avant “Viens discuter” */
.chat-pitch {
  margin: 1rem auto;           /* espace au-dessus et en-dessous */
  max-width: 240px;            /* limite la largeur pour aérer */
  font-size: 0.9rem;           /* un peu plus petit que les boutons */
  font-style: italic;          /* ton léger, informel */
  color: #555;                 /* gris mid-tone pour différencier */
  text-align: center;          /* centré sous les boutons */
  line-height: 1.4;            /* un interligne confortable */
}
    
    /* Header */
    .chat-header {
      position: fixed; top: 0; left: 0; right: 0; height: 4rem;
      display: flex; align-items: center; justify-content: center;
      background: var(--color-primary); color: #fff;
      font-size: 1.25rem; font-weight: bold;
      box-shadow: 0 2px 4px var(--shadow); z-index: 200;
      padding: 0 1rem;
    }
    #header-back-btn {
      position: absolute; left: 1rem; top: 50%; transform: translateY(-50%);
      background: none; border: none; color: #fff;
      font-size: 1.5rem; cursor: pointer;
      visibility: hidden;
    }
    .header-title { flex: 1; text-align: center; }

    /* Onboarding */
    .onboard-step {
      display: none; position: fixed;
      top: 4rem; bottom: 0; left: 0; right: 0;
      background: rgba(255,255,255,0.95); z-index: 100;
      flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: 1rem;
    }
    .onboard-step.active { display: flex; }
    .lang-btn, .btn-primary, .cta-options button {
      background: var(--color-primary); color: #fff; border: none;
      border-radius: var(--radius); padding: .75rem 1.5rem;
      cursor: pointer; margin: .5rem 0; width: 70%;
    }
    .lang-btn:hover, .btn-primary:hover, .cta-options button:hover {
      background: var(--color-primary-hover);
    }

    /* Main container */
    .chat-container {
      flex: 1; display: flex; flex-direction: column;
      margin: .5rem; background: #fff; border-radius: var(--radius);
      overflow: hidden; box-shadow: 0 4px 12px var(--shadow);
    }

    /* Sections & Chat */
    .section { display: none; flex: 1; overflow-y: auto; padding: 1rem; background: var(--color-bg); }
    .section.active { display: block; }
    .chat-scroll {
      display: none; flex: 1; overflow-y: auto;
      padding: 1rem; flex-direction: column; gap: 1rem; background: var(--color-bg);
    }
    .chat-scroll.active { display: flex; }
    form#chat-form { display: none; width: 100%; }
    form#chat-form.active { display: flex; }

    /* Input */
    .input-area {
      display: flex; align-items: center;
      padding: .75rem; background: #fff;
      box-shadow: 0 -2px 4px var(--shadow);
    }
    .input-area input {
      flex: 1; padding: .75rem 1rem; border: 1px solid #ccc;
      border-radius: 30px; outline: none; margin-right: .5rem;
    }
    .input-area button {
      background: var(--color-primary); border: none; color: #fff;
      width: 2.5rem; height: 2.5rem; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.25rem; cursor: pointer;
    }

    /* Vignettes */
    .service-tiles {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 1rem; margin-top: 1rem;
    }
    .section h2 { text-align: center; margin-bottom: 1rem; }
    .service-tile {
      display: flex; flex-direction: column; align-items: center;
      padding: .75rem; background: #fff; border-radius: var(--radius);
      box-shadow: 0 2px 6px var(--shadow); cursor: pointer;
      transition: transform .1s, box-shadow .1s;
    }
    .service-tile:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--shadow); }
    .service-tile img { width: 40px; height: 40px; margin-bottom: .5rem; }
    .service-tile span { font-size: .875rem; color: #333; text-align: center; }

    .chat-launch { grid-column: 1 / -1; display: flex; justify-content: center; margin-top: 2rem; }
  
  /* Méta-info en haut de la bulle */
.message .meta {
  display: block;
  font-size: 0.75rem;
  color: #666;
  margin-bottom: 0.25rem;
}
    /* Override pour remonter le contenu sous le header */
body {
  padding-top: 3rem !important;
}
.onboard-step {
  top: 3rem !important;
}

/* Espacement spécifique pour les <p> de l’écran langue */
#step-language p {
  margin: 0.5rem 0;         /* 0.5rem au-dessus et en-dessous */
}
    /* 1) Onboarding langue : contenu aligné en haut, peu de padding */
#step-language.onboard-step.active {
  top: 3rem !important;                /* remonte l’overlay */
  justify-content: flex-start !important; /* aligne le contenu en haut */
  padding-top: 2rem !important;      /* réduit l’espace interne haut */
  gap: 0.5rem;                         /* espace uniforme entre les <p> et les boutons */
}

/* 2) Marges propres pour chaque ligne de texte */
#step-language p {
  margin: 0.5rem 0;                    /* 0.5rem au-dessus et en-dessous */
}
    /* ─── Override spécifique pour les écrans Intro et CTA ───────────────── */
#step-intro.onboard-step.active,
#step-cta.onboard-step.active {
  /* 1) Décale l’overlay juste sous le header */
  top: 3rem !important;
  /* 2) Colle le contenu en haut au lieu de centrer */
  justify-content: flex-start !important;
  /* 3) Réduit le padding interne haut */
  padding-top: 2rem !important;
  /* 4) Espace régulier entre les enfants (<h2>, <p>, boutons) */
  gap: 1rem;
}

/* Si besoin, ajustez les marges des éléments internes */
#step-intro h2,
#step-cta h2 {
  margin-bottom: 2rem;  /* réduit l’espace sous le titre */
}
#step-intro p,
#step-cta .chat-pitch {
  margin-bottom: 2rem;    /* espace raisonnable sous le paragraphe */
}

    /* Empêche iOS de zoomer quand on focus l’input */
.input-area input {
  font-size: 16px; /* iOS stoppe son zoom automatique dès 16px */
}
    
  </style>
</head>
<body>
  <div class="chat-header">
    <button id="header-back-btn" aria-label="Retour">←</button>
    <div class="header-title">Julie</div>
  </div>

  <!-- Onboarding -->
  <div id="step-language" class="onboard-step active">
    <p>Choisissez votre langue</p>
    <p>Choose your language</p>
    <p>Elige tu idioma</p> 
    <p>Wähle deine Sprache</p>
    <button class="lang-btn" data-lang="fr">Français</button>
    <button class="lang-btn" data-lang="en">English</button>
    <button class="lang-btn" data-lang="es">Español</button>
    <button class="lang-btn" data-lang="de">Deutsch</button>
  </div>
  <div id="step-intro" class="onboard-step">
     <!-- Votre image, juste au-dessus du titre -->
  <img src="image2.png" alt="Illustration Julie" class="intro-image" />
    <h2 id="intro-title">Bienvenue !</h2>
    <p id="intro-text">Je suis <strong>Julie</strong>, votre concierge virtuelle pour votre séjour.</p>
    <button class="btn-primary" id="btn-intro-next">Cool !</button>
  </div>
  <div id="step-cta" class="onboard-step">
    <h2 id="cta-title">Par où commencer ?</h2>
    <br>
    <div class="cta-options">
      <button data-cta="section-services">Services de l'hôtel</button>
      <button data-cta="section-livret">Le livret d'accueil</button>
      <!-- === NOUVEAU : micro-copy Option C === -->
  <p class="chat-pitch">
    Parle à Julie : son IA et ses influenceurs locaux t’ont déniché les meilleurs spots autour de l’hôtel.
  </p>
      <button data-cta="chat">Lance le chat</button>
    </div>
  </div>

  <div class="chat-container">
    <!-- Services -->
    <div id="section-services" class="section">
      <h2>Services de l'hôtel</h2>
      <div class="service-tiles">
        <div class="service-tile" data-detail="roomservice">
          <img src="room.png" alt="Room Service"><span>Room Service</span>
        </div>
        <div class="service-tile" data-detail="spa">
          <img src="spa.png" alt="Spa"><span>Spa & Bien-être</span>
        </div>
        <div class="service-tile" data-detail="menage">
          <img src="menage.png" alt="Ménage"><span>Service de ménage</span>
        </div>
        <div class="service-tile" data-detail="petit-dejeuner">
          <img src="petit-dejeuner.png" alt="Petit-déjeuner"><span>Le petit-déjeuner</span>
        </div>
        <div class="chat-launch"><button class="btn-primary" id="btn-start-chat">Lancer le chat</button></div>
      </div>
    </div>

    <!-- Livret -->
    <div id="section-livret" class="section">
      <h2>Nous vous souhaitons un excellent séjour au sein de notre établissement</h2>
      <div class="service-tiles">
        <div class="service-tile" data-detail="wifi">
          <img src="wifi.png" alt="Wi-Fi"><span>Wi-Fi</span>
        </div>
        <div class="service-tile" data-detail="digicode">
          <img src="digicode.png" alt="Digicode"><span>Digicode</span>
        </div>
        <div class="service-tile" data-detail="checkout">
          <img src="checkout.png" alt="Check-out"><span>Check-out</span>
        </div>
        <div class="service-tile" data-detail="reception">
          <img src="reception.png" alt="Réception"><span>Réception</span>
        </div>
        <div class="service-tile" data-detail="infos-pratiques">
          <img src="infos.png" alt="Infos pratiques"><span>Infos pratiques</span>
        </div>
        <div class="service-tile" data-detail="livre-dor">
          <img src="livre-or.png" alt="Livre d'or"><span>Livre d'or</span>
        </div>
        <div class="chat-launch"><button class="btn-primary" id="btn-start-chat-2">Lancer le chat</button></div>
      </div>
    </div>

    <!-- Chat -->
    <div id="chat" class="chat-scroll"></div>
    <form id="chat-form" class="input-area">
      <input type="text" id="user-input" placeholder="Écris votre message…" autocomplete="off" />
      <button type="submit">➤</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ─── éléments de l’UI ─────────────────────────────────────────────
      const chatBox  = document.getElementById('chat');
      const chatForm = document.getElementById('chat-form');
      const inputEl  = document.getElementById('user-input');
    
      // ─── helper pour afficher un message ──────────────────────────────
      function addMessage(txt, cls) {
        const now = new Date();
        const hh  = String(now.getHours()).padStart(2, '0');
        const mm  = String(now.getMinutes()).padStart(2, '0');
        const wrapper = document.createElement('div');
        wrapper.className = `message-wrapper ${cls}`;
        const msg = document.createElement('div');
        msg.className = `message ${cls}`;
        const meta = document.createElement('span');
        meta.className = 'meta';
        meta.innerText = `${cls === 'bot' ? 'Julie' : 'Toi'} – ${hh}:${mm}`;
        msg.appendChild(meta);
        const content = document.createElement('div');
        content.innerHTML = txt;
        msg.appendChild(content);
        wrapper.appendChild(msg);
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    
      // ─── état conversation ────────────────────────────────────────────
      const conversationContext = {};
      let awaitingAmbiance = false;
    
      // ─── soumission du formulaire ──────────────────────────────────────
      chatForm.addEventListener('submit', async function handler(e) {
        e.preventDefault();
        const text = inputEl.value.trim();
        if (!text) return;
        addMessage(text, 'user');
        inputEl.value = '';
    
        try {
          // si on vient de donner l’ambiance, on la stocke
          if (awaitingAmbiance) {
            conversationContext.ambiance = text.toLowerCase();
            awaitingAmbiance = false;
          }
    
          // on envoie la requête
          const payload = {
            query: awaitingAmbiance
              ? conversationContext.lastQuery
              : text,
            context: conversationContext
          };
          const response = await fetch('/api/recommands', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
    
          if (!response.ok) {
            const errText = await response.text();
            console.error('Erreur serveur:', response.status, errText);
            throw new Error(`Serveur ${response.status}`);
          }
    
          const data = await response.json();
    
          // besoin de clarification ?
          if (data.needClarification) {
            // on mémorise la question initiale
            conversationContext.lastQuery = text;
            awaitingAmbiance = true;
            addMessage(data.message, 'bot');
            return;
          }
    
          // réponse finale
          addMessage(data.message, 'bot');
    
        } catch (err) {
          console.error(err);
          addMessage("Oups, une erreur est survenue.", 'bot');
        }
      });
      
      // ─── message de bienvenue ─────────────────────────────────────────
      addMessage("Salut ! Comment puis-je vous aider aujourd’hui ?", 'bot');
    });
    </script>
</body>
</html>